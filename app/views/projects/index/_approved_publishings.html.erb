<% viewable_publishings = current_user.admin? ? @approved_publishings : @approved_publishings.select { |pub| pub.project? ? pub.publishable.users.include?(current_user) : pub.publishable.project.users.include?(current_user) } %>
<% if viewable_publishings.blank? %>
  <h4>No approved publications found.</h4>
<% else %>
  <table>
    <thead>
      <tr>
        <th width="100">Name</th>
        <th width="50">Type</th>
        <th width="25">Creation Date</th>
        <th width="25">Publication Requested On</th>
        <th width="25">Date of Publication</th>
        <th width="100">View</th>
        <% if current_user.admin? %>
          <th width="25"></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% viewable_publishings.each do |ap| %>
        <tr>
          <td><%= ap.publishable.display %></td>
          <td style="text-align: center;"><%= ap.name_of_pub_type %></td>
          <td style="text-align: center;"><%= ap.publishable.created_at.strftime('%m-%d-%y') %></td>
          <td style="text-align: center;"><%= ap.created_at.strftime('%m-%d-%y') %></td>
          <td style="text-align: center;"><%= ap.approval.created_at.strftime('%m-%d-%y') %></td>
          <td style="text-align: center;">
            <% if ap.publishable.class == SdMetaDatum %>
              <%= link_to 'View', sd_meta_datum_path(ap.publishable_id), class: 'btn-link' %>
            <% elsif ap.publishable.class == Project %>
              <%= link_to 'Project Info', edit_project_path(ap.publishable, page: 'info'), class: 'btn-link' %>
              <% if current_user.admin? %>
                &nbsp; | &nbsp;
                <%= link_to 'Extr. Form', build_extraction_forms_project_path(ap.publishable.extraction_forms_projects.first), class: 'btn-link' %>
                &nbsp; | &nbsp;
                <%= link_to 'Extractions', project_extractions_path(ap.publishable), class: 'btn-link' %>
              <% end %>
            <% end %>
          </td>
          <% if current_user.admin? %>
            <td style="text-align: center;">
              <%= link_to 'Rescind Approval', rescind_approval_path(ap.publishable_id, type: ap.publishable.class.to_s), class: 'btn-link', method: :post, data: { confirm: "You are about to rescind approval for:\n\n#{ap.publishable.display}\n\nProceed?" } %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
