<!-- prettier-ignore -->
<%= render 'citations_in_ris' %>
<%= render 'selection' %>
<%= render 'create_extractions' %>
<%= render 'loading' %>
<%= render 'detail_view' %>
<%= render 'dashboard' %>
<div>
  <div class="sm:flex sm:items-center">
    <div class="sm:flex-auto">
      <h1 class="text-xl font-bold">Citation Lifecycle Management</h1>
      <p class="mt-2 text-sm text-gray-700">Promote or demote citations.</p>
      <div class="relative">
        <input
          x-model.debounce.500ms="query"
          @keyup.slash.window="$focus.focus($el)"
          class="!p-4 text-center"
          placeholder="To start searching, press '/'"
          type="search"
        />
        <div
          x-show="query != ''"
          x-cloak
          @click="query = ''"
          class="cursor-pointer absolute top-2 right-2"
        >
          Clear Results (X)
        </div>
      </div>
    </div>
  </div>
  <div class="my-4 flex flex-col">
    <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
      <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
        <div
          class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg mb-8"
        >
          <table class="w-full divide-y divide-gray-300">
            <thead class="bg-gray-50">
              <tr>
                <th
                  scope="col"
                  class="cursor-pointer py-3.5 text-left text-xs font-semibold text-gray-900 sm:pl-6"
                  @click="changeOrderBy('created_at')"
                >
                  <div class="flex justify-between">
                    Added On
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'created_at'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'created_at'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer py-3.5 text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('accession_number_alts')"
                >
                  <div class="flex justify-between">
                    Accession No. (e.g. PubMed ID)
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'accession_number_alts'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'accession_number_alts'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('author_map_string')"
                >
                  <div class="flex justify-between">
                    Authors
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'author_map_string'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'author_map_string'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('name')"
                >
                  <div class="flex justify-between">
                    Title
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'name'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'name'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('year')"
                >
                  <div class="flex justify-between">
                    Pub Date
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'year'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'year'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('abstract_qualification')"
                >
                  <div class="flex justify-between">
                    Abstract
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'abstract_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'abstract_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('fulltext_qualification')"
                >
                  <div class="flex justify-between">
                    Fulltext
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'fulltext_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'fulltext_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('extraction_qualification')"
                >
                  <div class="flex justify-between">
                    Extraction
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'extraction_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'extraction_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('consolidation_qualification')"
                >
                  <div class="flex justify-between">
                    Consolidation
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'consolidation_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'consolidation_qualification'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('screening_status')"
                >
                  <div class="flex justify-between">
                    Sub Status
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'screening_status'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'screening_status'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('extraction_count')"
                >
                  <div class="flex justify-between" title="No. of Extractions">
                    Extraction Count
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'extraction_count'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'extraction_count'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="cursor-pointer text-left text-xs font-semibold text-gray-900"
                  @click="changeOrderBy('consolidated_count')"
                >
                  <div class="flex justify-between" title="No. of Extractions">
                    Consolidated Count
                    <template
                      x-if="pagination.sort == 'asc' && pagination.order_by == 'consolidated_count'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        />
                      </svg>
                    </template>
                    <template
                      x-if="pagination.sort == 'desc' && pagination.order_by == 'consolidated_count'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"
                        />
                      </svg>
                    </template>
                  </div>
                </th>
                <th
                  scope="col"
                  class="text-left text-xs font-semibold text-gray-900 select-none"
                ></th>
                <th
                  scope="col"
                  class="text-left text-xs font-semibold text-gray-900 select-none"
                ></th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              <template x-if="results == null">
                <tr>
                  <td>Loading..</td>
                </tr>
              </template>
              <template x-if="results != null && results.length == 0">
                <tr>
                  <td>No results</td>
                </tr>
              </template>
              <template x-if="results != null">
                <template x-for="(result, i) in results">
                  <tr
                    :class="selected.some(selectedCp => selectedCp.citations_project_id == result.citations_project_id) ? '!bg-green-100' : '!bg-white'"
                  >
                    <td
                      class="text-xs text-gray-500 max-w-[100px] sm:pl-6 w-8 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.created_at"
                    ></td>
                    <td
                      class="text-xs text-gray-500 max-w-[250px] w-32 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.accession_number_alts"
                    ></td>
                    <td
                      class="px-1 text-xs text-gray-500 max-w-[150px] overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.author_map_string"
                    ></td>
                    <td
                      class="px-1 text-xs text-gray-500 max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.name"
                    ></td>
                    <td
                      class="px-1 text-xs text-gray-500 w-18 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.year"
                    ></td>
                    <td
                      class="px-1 text-xs text-gray-500 w-24 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.abstract_qualification"
                    ></td>
                    <td
                      class="px-1 text-xs text-gray-500 w-24 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.fulltext_qualification"
                    ></td>
                    <td
                      class="px-1 text-xs text-gray-500 w-24 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.extraction_qualification"
                    ></td>
                    <td
                      class="px-1 text-xs text-gray-500 w-24 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.consolidation_qualification"
                    ></td>
                    <td
                      class="px-1 text-xs text-black w-24 overflow-hidden text-ellipsis whitespace-nowrap"
                      :class="applyTdBg(result.screening_status)"
                      x-text="result.screening_status"
                    ></td>
                    <td
                      class="px-1 text-xs text-black w-24 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.extraction_count"
                    ></td>
                    <td
                      class="px-1 text-xs text-black w-24 overflow-hidden text-ellipsis whitespace-nowrap"
                      x-text="result.consolidated_count"
                    ></td>
                    <td
                      class="cursor-pointer select-none px-1 text-xs text-gray-500 w-18 overflow-hidden text-ellipsis whitespace-nowrap"
                      @click.stop="if (showDetailView && detailedResult == i) { showDetailView = false } else { detailedResult = i; showDetailView = true }"
                    >
                      <div>Details</div>
                    </td>
                    <td
                      class="cursor-pointer select-none px-1 text-xs text-gray-500 w-18 overflow-hidden text-ellipsis whitespace-nowrap"
                      @click="toggleSelection(i)"
                    >
                      <div>Select</div>
                    </td>
                  </tr>
                </template>
              </template>
            </tbody>
          </table>
        </div>
        <div><%= render '/components/pagination' %></div>
      </div>
    </div>
  </div>
</div>
